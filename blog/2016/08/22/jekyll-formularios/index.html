<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Un sistema de contribuciones a blogs Jekyll para gente sin conocimientos de Jekyll, GitHub o Markdown - David C</title>
  <link rel="stylesheet" href="/assets/stylesheets/normalize.css">
  <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
  <link rel="stylesheet" href="/assets/stylesheets/default.css">
</head>
<body>
  <aside class="top">
    <a href="/">
      <header>
        
        <img src="https://secure.gravatar.com/avatar/7083d161b041964b75c38376d9dee37a?s=200" class="profile-pic" />
        
        <span class="name">
          David Charte
        </span>
      </header>
    </a>
    <div class="arrow-up"></div>
  </aside>
  
<article class="article lang-es">
  <time datetime="2016-08-22">2016-08-22</time>
  
  <a href="/blog/2016/08/22/jekyll-formularios/">
    <h1>
        Un sistema de contribuciones a blogs Jekyll para gente sin conocimientos de Jekyll, GitHub o Markdown
        </h1>
        
  </a>
  
  <p>Durante un tiempo, los colaboradores del <a href="http://tux.ugr.es/dgiim/blog">blog de LibreIM</a> hemos tenido que componer los posts prácticamente a mano, haciendo uso de un editor de texto para escribirlos, Git para llevar el registro de cambios y una <em>pull request</em> en GitHub para enviar el post, revisarlo y corregirlo. Evidentemente, este puede ser un proceso ideal para desarrolladores acostumbrados al proceso, pero está lejos de ser perfecto cuando tratamos de mantener un blog colaborativo abierto a que cualquiera publique su conocimiento. Lo que buscamos es una forma de abstraer el proceso de edición y envío de posts para hacer el blog accesible a mucha más gente.</p>

<p>La solución que concebimos consta de dos partes: por un lado, un backend que utilizaría una cuenta <em>bot</em> de GitHub para la gestión automática de ramas y <em>pull requests</em>; por otro, una aplicación web con un formulario y un sencillo editor desde la que se enviarían los posts.</p>

<p class="fig"><img src="/assets/images/jekyll-form.png" alt="Formulario resultante" />
Un ejemplo del <a href="http://tux.ugr.es/dgiim/new/post">formulario resultante</a></p>

<h2 id="preparativos-previos">Preparativos previos</h2>

<p>Para crear nuevos <em>commits</em> y <em>pull requests</em> necesitamos una cuenta de GitHub. Podemos usar la propia o crear una nueva. Otorgaremos a dicha cuenta permisos de escritura sobre el repositorio de blog en cuestión. Después, obtendremos un <a href="https://github.com/settings/tokens">token de acceso personal</a> con permisos de modificación de repositorios. Dicho token lo almacenaremos en las variables de entorno de la shell donde vayamos a hospedar la aplicación, supongamos que bajo el nombre de <code class="language-plaintext highlighter-rouge">GITHUB_TOKEN</code>.</p>

<h2 id="el-backend">El backend</h2>

<p>Componer un guion que trabaje con Git automáticamente no es muy complicado. Se podría utilizar directamente un guion de Bash pero, en vistas a integrarlo en la aplicación web, usamos la <a href="https://rubygems.org/gems/git">gema git</a> para Ruby. Esta permite realizar todo tipo de operaciones sobre repositorios Git, a nosotros nos basta con clonar, abrir una nueva rama, incluir un nuevo archivo en un <em>commit</em> y enviarlo al repositorio remoto. El siguiente código Ruby define una función que realiza todo el proceso, notemos cómo se obtiene por parámetro un <em>block</em> (similar a una función anónima) que permite realizar las modificaciones pertinentes al repositorio:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># repo.rb</span>
<span class="nb">require</span> <span class="s1">'fileutils'</span>
<span class="nb">require</span> <span class="s1">'git'</span>

<span class="k">def</span> <span class="nf">modify_repo</span> <span class="n">repo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">commit_msg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
  <span class="n">dir</span> <span class="o">=</span> <span class="s2">".repo"</span>

  <span class="c1"># Usamos el token de acceso para clonar el repositorio</span>
  <span class="n">g</span> <span class="o">=</span> <span class="no">Git</span><span class="p">.</span><span class="nf">clone</span><span class="p">(</span><span class="s2">"https://</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s2">"GITHUB_TOKEN"</span><span class="p">]</span><span class="si">}</span><span class="s2">@github.com/</span><span class="si">#{</span><span class="n">repo</span><span class="si">}</span><span class="s2">.git"</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>

  <span class="c1"># Configuramos el email y nombre de la cuenta bot</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="s2">"user.name"</span><span class="p">,</span> <span class="s2">"BOT"</span><span class="p">)</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="s2">"user.email"</span><span class="p">,</span> <span class="s1">'BOT_EMAIL@example.org'</span><span class="p">)</span>

  <span class="c1"># Creamos una rama nueva</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">branch</span><span class="p">(</span><span class="n">head</span><span class="p">).</span><span class="nf">checkout</span>

  <span class="c1"># Realizamos modificaciones en el repo</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">chdir</span> <span class="p">{</span> <span class="n">block</span><span class="p">.</span><span class="nf">call</span> <span class="p">}</span>

  <span class="c1"># Commit y push</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="ss">all: </span><span class="kp">true</span><span class="p">)</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">commit</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">commit_msg</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="n">g</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="s2">"origin"</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>

  <span class="no">FileUtils</span><span class="p">.</span><span class="nf">rm_rf</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ahora hemos de añadir la capacidad de crear <em>pull requests</em>, para ello usamos la <a href="https://rubygems.org/gems/octokit">gema octokit</a>, que acepta el token de acceso que obtuvimos antes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># form.rb</span>
<span class="nb">require</span> <span class="s1">'octokit'</span>
<span class="nb">require_relative</span> <span class="s1">'repo'</span>

<span class="n">github</span> <span class="o">=</span> <span class="no">Octokit</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"GITHUB_TOKEN"</span><span class="p">])</span>

<span class="n">repo</span> <span class="o">=</span> <span class="s2">"BOT/blog"</span>
<span class="n">base</span> <span class="o">=</span> <span class="s2">"gh-pages"</span>
<span class="n">head</span> <span class="o">=</span> <span class="s2">"new-post"</span>

<span class="n">modify_repo</span> <span class="n">repo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span> <span class="k">do</span>
  <span class="c1"># Creación del nuevo post</span>
<span class="k">end</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">github</span><span class="p">.</span><span class="nf">create_pull_request</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
</code></pre></div></div>

<p>Únicamente nos queda obtener del usuario los datos necesarios para crear un nuevo post: un titulo, un autor, una categoría y el contenido.</p>

<h2 id="el-formulario">El formulario</h2>

<h3 id="sinatra">Sinatra</h3>

<p><a href="http://www.sinatrarb.com/">Sinatra</a> es un <em>domain specific language</em> (DSL) para Ruby que facilita la creación de aplicaciones web sencillas sin apenas esfuerzo. Basta con escribir las peticiones HTTP que se aceptan y cuál es la respuesta. Además, es muy útil utilizarlo junto a otras gemas de Ruby que ahorren trabajo a la hora de escribir las plantillas y el estilo. Nuestro archivo de dependencias <code class="language-plaintext highlighter-rouge">Gemfile</code> queda de la siguiente forma:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Gemfile</span>

<span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'sinatra'</span>
<span class="n">gem</span> <span class="s1">'sinatra-contrib'</span>
<span class="n">gem</span> <span class="s1">'thin'</span>      <span class="c1"># Web server</span>
<span class="n">gem</span> <span class="s1">'haml'</span>      <span class="c1"># For layouts</span>
<span class="n">gem</span> <span class="s1">'sass'</span>      <span class="c1"># For stylesheets</span>
<span class="n">gem</span> <span class="s1">'kramdown'</span>  <span class="c1"># For the preview</span>
<span class="n">gem</span> <span class="s1">'rouge'</span>     <span class="c1"># For syntax highlighting</span>
<span class="n">gem</span> <span class="s1">'octokit'</span>   <span class="c1"># For pull requests</span>
<span class="n">gem</span> <span class="s1">'git'</span>       <span class="c1"># Repo management</span>
<span class="n">gem</span> <span class="s1">'recaptcha'</span> <span class="c1"># Some protection against bots</span>
</code></pre></div></div>

<p>Para instalar y manejar las dependencias usamos <a href="http://bundler.io/">Bundler</a>: basta así con ejecutar <code class="language-plaintext highlighter-rouge">gem install bundler</code> y tras esto <code class="language-plaintext highlighter-rouge">bundle install</code>.</p>

<h3 id="respondiendo-a-peticiones">Respondiendo a peticiones</h3>

<p>Vamos a ampliar el archivo <code class="language-plaintext highlighter-rouge">form.rb</code> creado anteriormente para aceptar y responder un par de peticiones HTTP. Responderemos a <code class="language-plaintext highlighter-rouge">GET /</code> mostrando el formulario, que crearemos aparte en una vista en Haml. Por otro lado, al enviar dicho formulario se creará una petición <code class="language-plaintext highlighter-rouge">POST /posts</code> con los datos que necesitamos para componer el nuevo post.</p>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">-# views/form.haml
</span><span class="nt">%h1</span> Nuevo post
<span class="nt">%form</span><span class="p">{</span><span class="ss">action: </span><span class="s2">"/posts"</span><span class="p">,</span> <span class="ss">method: </span><span class="s2">"post"</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"text"</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"title"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Título"</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"text"</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"author"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Autor 1, Autor 2, ..."</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"text"</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"category"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Categoría"</span><span class="p">}</span>
  <span class="nt">%textarea</span><span class="p">{</span><span class="ss">name: </span><span class="s2">"content"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Contenido"</span><span class="p">}</span>
  <span class="nt">%input</span><span class="p">{</span><span class="ss">type: </span><span class="s2">"submit"</span><span class="p">,</span> <span class="ss">value: </span><span class="s2">"Enviar"</span><span class="p">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># form.rb</span>
<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'bundler'</span>
<span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:default</span><span class="p">)</span>
<span class="nb">require_relative</span> <span class="s2">"repo"</span>

<span class="n">get</span> <span class="s2">"/"</span> <span class="k">do</span>
  <span class="c1"># Mostramos el formulario</span>
  <span class="n">haml</span> <span class="ss">:form</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s2">"/posts/?"</span> <span class="k">do</span>
  <span class="c1"># Obtenemos los datos</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:title</span><span class="p">]</span>
  <span class="n">author</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:author</span><span class="p">]</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:content</span><span class="p">]</span>
  <span class="n">category</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"unclassified"</span>

  <span class="c1"># Creamos el nombre del archivo</span>
  <span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="p">.</span><span class="nf">strftime</span> <span class="s2">"%Y-%m-%d"</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="n">title</span><span class="p">.</span><span class="nf">downcase</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)[</span><span class="mi">0</span><span class="o">..</span><span class="mi">4</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s2">"-"</span><span class="p">)</span>

  <span class="n">github</span> <span class="o">=</span> <span class="no">Octokit</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"GITHUB_TOKEN"</span><span class="p">])</span>

  <span class="n">repo</span> <span class="o">=</span> <span class="s2">"BOT/blog"</span>
  <span class="n">base</span> <span class="o">=</span> <span class="s2">"gh-pages"</span>
  <span class="n">head</span> <span class="o">=</span> <span class="s2">"new-post-</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span>

  <span class="n">modify_repo</span> <span class="n">repo</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span> <span class="k">do</span>
    <span class="c1"># Creamos el archivo del post</span>
    <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"_posts/</span><span class="si">#{</span><span class="n">date</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.md"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
---
layout: post
title: </span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="sh">
authors: </span><span class="si">#{</span><span class="n">author</span><span class="p">.</span><span class="nf">split</span> <span class="sr">/,\s*/</span><span class="si">}</span><span class="sh">
category: </span><span class="si">#{</span><span class="n">category</span><span class="si">}</span><span class="sh">
---

</span><span class="si">#{</span><span class="n">content</span><span class="si">}</span><span class="sh">
</span><span class="no">EOF</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">response</span> <span class="o">=</span> <span class="n">github</span><span class="p">.</span><span class="nf">create_pull_request</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="s2">"Nuevo post"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Para iniciar el servidor web con nuestra aplicación, debería bastar con ejecutar <code class="language-plaintext highlighter-rouge">ruby form.rb</code> en el terminal.</p>

<h3 id="añadiendo-un-editor-de-verdad">Añadiendo un editor de verdad</h3>

<p>Todo esto ya está muy bien, y la aplicación ahorra un montón de esfuerzo para cada vez que se crea un nuevo post. Pero aún queda una barrera que evitaría que algunos usuarios estuvieran cómodos escribiendo: el marcado de formato con Markdown. Existen diversos editores Markdown que pueden incrustarse en una página web, algunos con amplias funcionalidades y otros más sencillos. Nosotros optamos por <a href="https://simplemde.com/">SimpleMDE</a>, que facilita la escritura mediante algunas pistas visuales en el código y unos botones que dan acceso a la mayoría de opciones de formato de Markdown.</p>

<p>Este editor aporta además una opción de previsualización personalizable, lo que quiere decir que podemos modificar la forma en que se compila el código Markdown y se muestra dicha vista previa. Como los blogs Jekyll usan el intérprete <a href="http://kramdown.gettalong.org/">Kramdown</a> por defecto, podemos añadir una ruta al servidor que compile un documento mediante esta herramienta. Además, utilizamos también la gema <a href="http://rouge.jneen.net/">Rouge</a> para resaltado de código.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># form.rb</span>
<span class="c1"># ...</span>
<span class="n">post</span> <span class="s2">"/preview/?"</span> <span class="k">do</span>
  <span class="no">Kramdown</span><span class="o">::</span><span class="no">Document</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:content</span><span class="p">],</span> <span class="ss">syntax_highlighter: :rouge</span><span class="p">).</span><span class="nf">to_html</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Por otro lado, el editor habrá que inicializarlo mediante un código similar al siguiente:</p>

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%form</span><span class="p">{</span><span class="ss">action: </span><span class="s2">"/posts"</span><span class="p">,</span> <span class="ss">method: </span><span class="s2">"post"</span><span class="p">}</span>
  <span class="c">-# ...
</span>  <span class="nt">%textarea</span><span class="nf">#markdown_editor</span><span class="p">{</span><span class="ss">name: </span><span class="s2">"content"</span><span class="p">,</span> <span class="ss">placeholder: </span><span class="s2">"Contenido"</span><span class="p">}</span>

<span class="nt">%link</span><span class="p">{</span><span class="ss">rel: </span><span class="s2">"stylesheet"</span><span class="p">,</span> <span class="ss">href: </span><span class="s2">"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css"</span><span class="p">}</span>
<span class="nt">%script</span><span class="p">{</span><span class="ss">src: </span><span class="s2">"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"</span><span class="p">}</span>
<span class="nd">:javascript
</span>  <span class="c1">// La típica función para peticiones AJAX</span>
  <span class="kd">function</span> <span class="nx">AjaxRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xmlhttp</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span>
      <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="dl">"</span><span class="s2">Microsoft.XMLHTTP</span><span class="dl">"</span><span class="p">);</span>

    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/x-www-form-urlencoded</span><span class="dl">"</span><span class="p">);</span>

    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Inicializa el editor Markdown con algunas opciones extra</span>
  <span class="kd">var</span> <span class="nx">simplemde</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleMDE</span><span class="p">({</span>
    <span class="na">element</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">markdown_editor</span><span class="dl">"</span><span class="p">),</span>
    <span class="na">blockStyles</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">code</span><span class="p">:</span> <span class="dl">"</span><span class="s2">~~~</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="c1">// Usa el sistema propio para vista previa (kramdown + rouge)</span>
    <span class="na">previewRender</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">plainText</span><span class="p">,</span> <span class="nx">preview</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Esperar un segundo sin cambios para hacer la petición</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">delay</span><span class="p">)</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">AjaxRequest</span><span class="p">(</span><span class="dl">"</span><span class="s2">/preview</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">content=</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">plainText</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// `preview` es el nodo que contiene la vista previa</span>
          <span class="nx">preview</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">preview</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>Ahora sí, con todo esto tenemos un editor que facilita la tarea de escribir un post a cualquiera.</p>

<h2 id="los-extras">Los extras</h2>

<p>Un par de funcionalidades adicionales que hemos utilizado en <a href="http://tux.ugr.es/dgiim/new/post">el formulario para LibreIM</a> son la inclusión de <a href="http://mathjax.org/">MathJax</a> para interpretar fórmulas en LaTeX, y de un CAPTCHA mediante la gema <a href="https://rubygems.org/gems/recaptcha/">recaptcha</a>. No entro aquí en más detalle porque son fáciles de usar; además, todo nuestro código está <a href="https://github.com/libreim/form-im">publicado en GitHub</a>.</p>

<h2 id="en-conclusión">En conclusión…</h2>

<p>Mantener un blog en Jekyll tiene muchas ventajas: se puede hostear en cualquier servidor ya que es un generador de sitios estáticos, se puede realizar control de cambios por Git, etc. Y, con un poco de trabajo y una pequeña aplicación web, también se puede hacer accesible la colaboración a cualquier persona, incluso sin conocimientos de GitHub, Jekyll o Markdown. Ahora queda la parte complicada: convencer a más personas para que contribuyan al blog ;)</p>

  

</article>


  <footer>
    &copy; 2022 David Charte. Shared under
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">
      <i class="icon fa fa-creative-commons fa-lg"></i> BY-SA</a>.
  </footer>
    
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.0.11/css/fork-awesome.min.css" integrity="sha256-MGU/JUq/40CFrfxjXb5pZjpoZmxiP2KuICN5ElLFNd8=" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/stylesheets/highlight.css">
</body>
</html>
  